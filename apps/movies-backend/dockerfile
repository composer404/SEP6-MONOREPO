# Builder.
FROM node:16-alpine as builder

WORKDIR /app

COPY ./prisma ./prisma
COPY ./package.json ./package.json

RUN npm install

COPY . .

ARG AUTH_JWT_SECRET
ENV AUTH_JWT_SECRET=$AUTH_JWT_SECRET

ARG INSTANCE_CONNECTION_NAME
ENV INSTANCE_CONNECTION_NAME=$INSTANCE_CONNECTION_NAME

ARG AUTH_JWT_EXPIRES_IN
ENV AUTH_JWT_SECRET=$AUTH_JWT_EXPIRES_IN

ARG DATABASE_URL
ENV DATABASE_URL=$DATABASE_URL

RUN npm run build

EXPOSE 8080
CMD [ "npm", "run" ,"start:prod" ]